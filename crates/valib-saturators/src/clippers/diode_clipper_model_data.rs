use numeric_literals::replace_float_literals;

use super::DiodeClipperModel;
use valib_core::Scalar;

// These seemingly magic constants have been fit against the diode clipper circuit equation for
// combinations of up to 5 diodes in series each way.
//
// See the `clippers.ipynb` Notebook to see the rationale and working out process.
impl<T: Scalar> DiodeClipperModel<T> {
    #[replace_float_literals(T::from_f64(literal))]
    pub fn new_silicon(nf: u8, nb: u8) -> Self {
        let [a, b, si, so] = match (nf, nb) {
            // RMS error: -54.7 dB
            (1, 1) => [
                14.818703633669296,
                14.818703633541146,
                10.303204570696694,
                0.048404774265213925,
            ],
            // RMS error: -35.1 dB
            (1, 2) => [
                22.304806511403722,
                9.055985923658788,
                6.927666963557559,
                0.07081909604048883,
            ],
            // RMS error: -29.4 dB
            (1, 3) => [
                27.83682166632861,
                6.632634104057635,
                5.490576255404195,
                0.08840289037667301,
            ],
            // RMS error: -26.2 dB
            (1, 4) => [
                29.45764524305769,
                4.5567503249490136,
                4.354372165627167,
                0.11255226896931593,
            ],
            // RMS error: -24.4 dB
            (1, 5) => [
                33.57088716701823,
                3.8077841779405666,
                3.9253229508761422,
                0.12514246621927497,
            ],
            // RMS error: -35.1 dB
            (2, 1) => [
                9.055985630091193,
                22.30480590322051,
                6.927666800040047,
                0.0708190977258508,
            ],
            // RMS error: -45.4 dB
            (2, 2) => [
                14.971157352076087,
                14.971157351972952,
                4.935272490385709,
                0.09960226412923741,
            ],
            // RMS error: -34.6 dB
            (2, 3) => [
                17.973630352246342,
                10.787672828377609,
                3.796833960006928,
                0.1301342984492022,
            ],
            // RMS error: -29.9 dB
            (2, 4) => [
                21.1260322620653,
                8.85153502088645,
                3.2491921551375893,
                0.15204639135544615,
            ],
            // RMS error: -27.0 dB
            (2, 5) => [
                24.65489190333599,
                7.873228311604425,
                2.9631869422556916,
                0.16636658308860694,
            ],
            // RMS error: -29.4 dB
            (3, 1) => [
                6.632634263625567,
                27.836822172082755,
                5.490576348205737,
                0.08840288892239352,
            ],
            // RMS error: -34.6 dB
            (3, 2) => [
                10.78767264563271,
                17.973630074396567,
                3.7968339091296066,
                0.1301343002060695,
            ],
            // RMS error: -40.7 dB
            (3, 3) => [
                13.773060202439934,
                13.773060202390932,
                3.039730452207837,
                0.16352465685482764,
            ],
            // RMS error: -35.0 dB
            (3, 4) => [
                16.4147927572133,
                11.51224228626526,
                2.609401513692385,
                0.1901370719990656,
            ],
            // RMS error: -30.2 dB
            (3, 5) => [
                19.110713301436366,
                10.234871063495593,
                2.359010761494735,
                0.2095944159908213,
            ],
            // RMS error: -26.2 dB
            (4, 1) => [
                4.556750105154949,
                29.457644297178,
                4.354372038129143,
                0.11255227228626259,
            ],
            // RMS error: -29.9 dB
            (4, 2) => [
                8.851535557042167,
                21.126033366316427,
                3.249192304745862,
                0.15204638424486316,
            ],
            // RMS error: -35.0 dB
            (4, 3) => [
                11.512242398248342,
                16.41479290802926,
                2.6094015341085055,
                0.19013707047003173,
            ],
            // RMS error: -39.0 dB
            (4, 4) => [
                13.587560756126122,
                13.587560756154861,
                2.213920086653699,
                0.22415662110964293,
            ],
            // RMS error: -34.0 dB
            (4, 5) => [
                15.32747425290704,
                11.686555134402598,
                1.9434656047424366,
                0.2550809445437195,
            ],
            // RMS error: -24.4 dB
            (5, 1) => [
                3.8077847004238623,
                33.57088999439904,
                3.925323257613624,
                0.1251424564073139,
            ],
            // RMS error: -27.0 dB
            (5, 2) => [
                7.87322743815079,
                24.65488964162679,
                2.963186695510247,
                0.16636659704872075,
            ],
            // RMS error: -30.2 dB
            (5, 3) => [
                10.23487135966561,
                19.11071380499931,
                2.3590108165594486,
                0.2095944110358262,
            ],
            // RMS error: -34.0 dB
            (5, 4) => [
                11.68655494873491,
                15.327474019142276,
                1.9434655788195956,
                0.2550809479824465,
            ],
            // RMS error: -36.0 dB
            (5, 5) => [
                12.671621959956356,
                12.671621960002675,
                1.6497680835927957,
                0.30130466525225386,
            ],

            _ => unreachable!("# diodes in clipper must be within 1..=5"),
        };
        Self { a, b, si, so }
    }

    #[replace_float_literals(T::from_f64(literal))]
    pub fn new_germanium(nf: u8, nb: u8) -> Self {
        let [a, b, si, so] = match (nf, nb) {
            // RMS error: -55.8 dB
            (1, 1) => [
                11.5400845375653,
                11.54008453755682,
                9.323462928313877,
                0.05325608011540467,
            ],
            // RMS error: -33.7 dB
            (1, 2) => [
                17.114012636322936,
                6.520532735414192,
                5.9660442404806115,
                0.0805916493680095,
            ],
            // RMS error: -28.7 dB
            (1, 3) => [
                20.48952198353765,
                4.276190940097426,
                4.625624633029001,
                0.10509076725785854,
            ],
            // RMS error: -25.7 dB
            (1, 4) => [
                24.924278937478302,
                3.454498132921272,
                4.058630262990479,
                0.1188475990361746,
            ],
            // RMS error: -23.5 dB
            (1, 5) => [
                26.721721240417175,
                2.507960256975109,
                3.4738220324485374,
                0.1399443292737987,
            ],
            // RMS error: -33.7 dB
            (2, 1) => [
                6.520532729638227,
                17.114012624715265,
                5.966044235341096,
                0.08059164941701444,
            ],
            // RMS error: -43.5 dB
            (2, 2) => [
                11.02640288513309,
                11.026402884878669,
                4.291117939593952,
                0.11536646931367568,
            ],
            // RMS error: -34.4 dB
            (2, 3) => [
                14.533013424724732,
                8.511825817810664,
                3.4735402027036995,
                0.14131322589879164,
            ],
            // RMS error: -28.8 dB
            (2, 4) => [
                16.937043732260104,
                6.791400292393449,
                2.9228351699391792,
                0.16733510445063024,
            ],
            // RMS error: -26.1 dB
            (2, 5) => [
                19.376596264394376,
                5.809049182400577,
                2.6159743416035255,
                0.1871499295078922,
            ],
            // RMS error: -28.7 dB
            (3, 1) => [
                4.276190848467747,
                20.489521688316827,
                4.6256245730588015,
                0.10509076858938406,
            ],
            // RMS error: -34.4 dB
            (3, 2) => [
                8.511825890557008,
                14.533013535033335,
                3.4735402239564475,
                0.14131322499107757,
            ],
            // RMS error: -39.9 dB
            (3, 3) => [
                11.221744256814544,
                11.221744256789359,
                2.7993126992152884,
                0.17539979808380177,
            ],
            // RMS error: -33.7 dB
            (3, 4) => [
                12.786314164018439,
                8.80960556513696,
                2.3165274539217457,
                0.21310587584992127,
            ],
            // RMS error: -29.4 dB
            (3, 5) => [
                14.944086560990339,
                7.761491438965937,
                2.0878113150885897,
                0.2355657933505045,
            ],
            // RMS error: -25.7 dB
            (4, 1) => [
                3.4544980569650905,
                24.924278606936326,
                4.058630216035625,
                0.11884760045644698,
            ],
            // RMS error: -28.8 dB
            (4, 2) => [
                6.791400773290698,
                16.937044728316703,
                2.922835318135986,
                0.1673350958334341,
            ],
            // RMS error: -33.7 dB
            (4, 3) => [
                8.809605599711244,
                12.7863142112424,
                2.316527461244717,
                0.21310587517977705,
            ],
            // RMS error: -37.9 dB
            (4, 4) => [
                10.441945119868427,
                10.44194511986937,
                1.9601655094770618,
                0.25266140145561866,
            ],
            // RMS error: -33.3 dB
            (4, 5) => [
                12.038952144294493,
                9.065075400829505,
                1.7383500923762814,
                0.28408682775109595,
            ],
            // RMS error: -23.5 dB
            (5, 1) => [
                2.507959861241324,
                26.72171904308753,
                3.47382177258786,
                0.13994433981380425,
            ],
            // RMS error: -26.1 dB
            (5, 2) => [
                5.809049304356745,
                19.37659658423775,
                2.615974379936075,
                0.1871499267401644,
            ],
            // RMS error: -29.4 dB
            (5, 3) => [
                7.761491740996892,
                14.944087078303756,
                2.0878113770727436,
                0.23556578621710847,
            ],
            // RMS error: -33.3 dB
            (5, 4) => [
                9.065075112224644,
                12.0389517800131,
                1.7383500481043026,
                0.28408683512693533,
            ],
            // RMS error: -35.1 dB
            (5, 5) => [
                9.976428211164698,
                9.976428211194003,
                1.4863323626341958,
                0.3332234739122749,
            ],

            _ => unreachable!("# diodes in clipper must be within 1..=5"),
        };
        Self { a, b, si, so }
    }

    #[replace_float_literals(T::from_f64(literal))]
    pub fn new_led(nf: u8, nb: u8) -> Self {
        let [a, b, si, so] = match (nf, nb) {
            // RMS error: -47.7 dB
            (1, 1) => [
                20.65347148109766,
                20.653471481154803,
                7.594954763586823,
                0.06552363046671784,
            ],
            // RMS error: -32.7 dB
            (1, 2) => [
                30.249110520024487,
                13.201153494176584,
                5.188084355984697,
                0.0954702131520826,
            ],
            // RMS error: -27.9 dB
            (1, 3) => [
                40.94596715905775,
                11.196657333110457,
                4.5265834640450295,
                0.10906012028802912,
            ],
            // RMS error: -25.6 dB
            (1, 4) => [
                50.81906544296935,
                10.060689997764351,
                4.172941275666941,
                0.11863323400690703,
            ],
            // RMS error: -24.7 dB
            (1, 5) => [
                65.86240112805793,
                10.44110850551693,
                4.30573525429852,
                0.11520486583246227,
            ],
            // RMS error: -32.7 dB
            (2, 1) => [
                13.201154433720905,
                30.24911244202003,
                5.188084652776518,
                0.09547020761506235,
            ],
            // RMS error: -42.1 dB
            (2, 2) => [
                19.64148871712622,
                19.641488716923515,
                3.5427102684048886,
                0.14074215157459155,
            ],
            // RMS error: -33.3 dB
            (2, 3) => [
                24.52589958800381,
                15.287539091459426,
                2.839846550858886,
                0.17530994426103833,
            ],
            // RMS error: -28.7 dB
            (2, 4) => [
                30.074218623962484,
                13.527670484429771,
                2.5516207410632936,
                0.19479670597237508,
            ],
            // RMS error: -26.8 dB
            (2, 5) => [
                39.77951278843257,
                14.172349162704148,
                2.651568913870041,
                0.1872061058597384,
            ],
            // RMS error: -27.9 dB
            (3, 1) => [
                11.196658080597853,
                40.94596947161434,
                4.526583704602034,
                0.10906011449542266,
            ],
            // RMS error: -33.3 dB
            (3, 2) => [
                15.287539245133733,
                24.52589982022816,
                2.8398465759102574,
                0.1753099427329486,
            ],
            // RMS error: -39.1 dB
            (3, 3) => [
                18.43003952339612,
                18.43003952356486,
                2.19441152144947,
                0.22723209121231377,
            ],
            // RMS error: -33.5 dB
            (3, 4) => [
                21.449643475903926,
                15.41133185368822,
                1.8689142270555195,
                0.26667060503658413,
            ],
            // RMS error: -29.7 dB
            (3, 5) => [
                25.497736004264116,
                14.288764564427467,
                1.7465158737303428,
                0.2851729590371428,
            ],
            // RMS error: -25.6 dB
            (4, 1) => [
                10.06069330461686,
                50.81907911434716,
                4.172942347522746,
                0.11863320350356941,
            ],
            // RMS error: -28.7 dB
            (4, 2) => [
                13.527671524133611,
                30.074220727476796,
                2.5516209077734024,
                0.19479669318997003,
            ],
            // RMS error: -33.5 dB
            (4, 3) => [
                15.411332063563798,
                21.449643757163656,
                1.8689142495170454,
                0.2666706018098041,
            ],
            // RMS error: -37.3 dB
            (4, 4) => [
                16.956694279720544,
                16.956694279595705,
                1.5075197272020926,
                0.3308216534905393,
            ],
            // RMS error: -33.7 dB
            (4, 5) => [
                18.932282144451595,
                14.690273305730267,
                1.323194606128341,
                0.3768475198184492,
            ],
            // RMS error: -24.7 dB
            (5, 1) => [
                10.441112631259454,
                65.86242226028934,
                4.305736591922761,
                0.11520483002320421,
            ],
            // RMS error: -26.8 dB
            (5, 2) => [
                14.172350649807482,
                39.77951654014127,
                2.6515691523613865,
                0.18720608898447055,
            ],
            // RMS error: -29.7 dB
            (5, 3) => [
                14.288764467617598,
                25.49773584241314,
                1.7465158635910751,
                0.2851729607270607,
            ],
            // RMS error: -33.7 dB
            (5, 4) => [
                14.690272625786957,
                18.932281268871673,
                1.3231945542477979,
                0.3768475353686442,
            ],
            // RMS error: -36.2 dB
            (5, 5) => [
                15.114392206651456,
                15.114392206572566,
                1.0744253357805404,
                0.4642855174037291,
            ],

            _ => unreachable!("# diodes in clipper must be within 1..=5"),
        };
        Self { a, b, si, so }
    }
}
